<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Discrete Filter Debug | Jan Ole von Hartz</title><meta name=keywords content><meta name=description content="This is a test/examle post.
How to
>>> import torch >>> import matplotlib.pyplot as plt >>> def plot(pr, sm, po, channel): ... for i, d in enumerate([pr[channel], sm[channel], po[channel], (sm*pr)[channel]]): ... plt.subplot(1, 4, i+1) ... plt.imshow(d) ... plt.show() >>> pr = torch.load('/export/hartzj/TakeLidOffSaucepan/demos_gt/encodings/dcm_10_keypoints_encoder-resnet101bs128split9010/new_ego/2022_05_03-14_34_44/cam_w_prior/80.dat') >>> po = torch.load('/export/hartzj/TakeLidOffSaucepan/demos_gt/encodings/dcm_10_keypoints_encoder-resnet101bs128split9010/new_ego/2022_05_03-14_34_44/cam_w_post/80.dat') >>> sm = torch.load('/export/hartzj/TakeLidOffSaucepan/demos_gt/encodings/dcm_10_keypoints_encoder-resnet101bs128split9010/new_ego/2022_05_03-14_34_44/cam_w_sm/80.dat') Results for sigma=2
Channels: 10, 2, 14
While on 2 it resolves the multimodality, on channel 10 it does not manage to do it."><meta name=author content="Jan Ole von Hartz"><link rel=canonical href=https://vonhartz.info/pages/discrete-filter-debug/><link crossorigin=anonymous href=/assets/css/stylesheet.min.8cc93f1ae8a05eb2bd7e5f1c9465a4cc977f44a0ff5703e408bd6ca0f933c4bf.css integrity="sha256-jMk/GuigXrK9fl8clGWkzJd/RKD/VwPkCL1soPkzxL8=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://vonhartz.info/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://vonhartz.info/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://vonhartz.info/favicon-32x32.png><link rel=apple-touch-icon href=https://vonhartz.info/apple-touch-icon.png><link rel=mask-icon href=https://vonhartz.info/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=google-site-verification content="0lS7TDuDPz3S26bF27ex8mccoHVHOpQIC5GOXHf33Uk"><meta name=generator content="Hugo 0.106.0"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Discrete Filter Debug"><meta property="og:description" content="This is a test/examle post.
How to
>>> import torch >>> import matplotlib.pyplot as plt >>> def plot(pr, sm, po, channel): ... for i, d in enumerate([pr[channel], sm[channel], po[channel], (sm*pr)[channel]]): ... plt.subplot(1, 4, i+1) ... plt.imshow(d) ... plt.show() >>> pr = torch.load('/export/hartzj/TakeLidOffSaucepan/demos_gt/encodings/dcm_10_keypoints_encoder-resnet101bs128split9010/new_ego/2022_05_03-14_34_44/cam_w_prior/80.dat') >>> po = torch.load('/export/hartzj/TakeLidOffSaucepan/demos_gt/encodings/dcm_10_keypoints_encoder-resnet101bs128split9010/new_ego/2022_05_03-14_34_44/cam_w_post/80.dat') >>> sm = torch.load('/export/hartzj/TakeLidOffSaucepan/demos_gt/encodings/dcm_10_keypoints_encoder-resnet101bs128split9010/new_ego/2022_05_03-14_34_44/cam_w_sm/80.dat') Results for sigma=2
Channels: 10, 2, 14
While on 2 it resolves the multimodality, on channel 10 it does not manage to do it."><meta property="og:type" content="article"><meta property="og:url" content="https://vonhartz.info/pages/discrete-filter-debug/"><meta property="article:section" content="pages"><meta property="article:published_time" content="2022-11-23T00:00:00+00:00"><meta property="article:modified_time" content="2022-11-23T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Discrete Filter Debug"><meta name=twitter:description content="This is a test/examle post.
How to
>>> import torch >>> import matplotlib.pyplot as plt >>> def plot(pr, sm, po, channel): ... for i, d in enumerate([pr[channel], sm[channel], po[channel], (sm*pr)[channel]]): ... plt.subplot(1, 4, i+1) ... plt.imshow(d) ... plt.show() >>> pr = torch.load('/export/hartzj/TakeLidOffSaucepan/demos_gt/encodings/dcm_10_keypoints_encoder-resnet101bs128split9010/new_ego/2022_05_03-14_34_44/cam_w_prior/80.dat') >>> po = torch.load('/export/hartzj/TakeLidOffSaucepan/demos_gt/encodings/dcm_10_keypoints_encoder-resnet101bs128split9010/new_ego/2022_05_03-14_34_44/cam_w_post/80.dat') >>> sm = torch.load('/export/hartzj/TakeLidOffSaucepan/demos_gt/encodings/dcm_10_keypoints_encoder-resnet101bs128split9010/new_ego/2022_05_03-14_34_44/cam_w_sm/80.dat') Results for sigma=2
Channels: 10, 2, 14
While on 2 it resolves the multimodality, on channel 10 it does not manage to do it."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Pages","item":"https://vonhartz.info/pages/"},{"@type":"ListItem","position":3,"name":"Discrete Filter Debug","item":"https://vonhartz.info/pages/discrete-filter-debug/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Discrete Filter Debug","name":"Discrete Filter Debug","description":"This is a test/examle post.\nHow to\n\u0026gt;\u0026gt;\u0026gt; import torch \u0026gt;\u0026gt;\u0026gt; import matplotlib.pyplot as plt \u0026gt;\u0026gt;\u0026gt; def plot(pr, sm, po, channel): ... for i, d in enumerate([pr[channel], sm[channel], po[channel], (sm*pr)[channel]]): ... plt.subplot(1, 4, i+1) ... plt.imshow(d) ... plt.show() \u0026gt;\u0026gt;\u0026gt; pr = torch.load(\u0026#39;/export/hartzj/TakeLidOffSaucepan/demos_gt/encodings/dcm_10_keypoints_encoder-resnet101bs128split9010/new_ego/2022_05_03-14_34_44/cam_w_prior/80.dat\u0026#39;) \u0026gt;\u0026gt;\u0026gt; po = torch.load(\u0026#39;/export/hartzj/TakeLidOffSaucepan/demos_gt/encodings/dcm_10_keypoints_encoder-resnet101bs128split9010/new_ego/2022_05_03-14_34_44/cam_w_post/80.dat\u0026#39;) \u0026gt;\u0026gt;\u0026gt; sm = torch.load(\u0026#39;/export/hartzj/TakeLidOffSaucepan/demos_gt/encodings/dcm_10_keypoints_encoder-resnet101bs128split9010/new_ego/2022_05_03-14_34_44/cam_w_sm/80.dat\u0026#39;) Results for sigma=2\nChannels: 10, 2, 14\nWhile on 2 it resolves the multimodality, on channel 10 it does not manage to do it.","keywords":[],"articleBody":"This is a test/examle post.\nHow to\n\u003e\u003e\u003e import torch \u003e\u003e\u003e import matplotlib.pyplot as plt \u003e\u003e\u003e def plot(pr, sm, po, channel): ... for i, d in enumerate([pr[channel], sm[channel], po[channel], (sm*pr)[channel]]): ... plt.subplot(1, 4, i+1) ... plt.imshow(d) ... plt.show() \u003e\u003e\u003e pr = torch.load('/export/hartzj/TakeLidOffSaucepan/demos_gt/encodings/dcm_10_keypoints_encoder-resnet101bs128split9010/new_ego/2022_05_03-14_34_44/cam_w_prior/80.dat') \u003e\u003e\u003e po = torch.load('/export/hartzj/TakeLidOffSaucepan/demos_gt/encodings/dcm_10_keypoints_encoder-resnet101bs128split9010/new_ego/2022_05_03-14_34_44/cam_w_post/80.dat') \u003e\u003e\u003e sm = torch.load('/export/hartzj/TakeLidOffSaucepan/demos_gt/encodings/dcm_10_keypoints_encoder-resnet101bs128split9010/new_ego/2022_05_03-14_34_44/cam_w_sm/80.dat') Results for sigma=2\nChannels: 10, 2, 14\nWhile on 2 it resolves the multimodality, on channel 10 it does not manage to do it. On Channel 14 it further manages to sharpen the cluster, but sometimes it also fails to do that.\nI think the noise component in the motion model is too strong.\nIf you look at successive frames of the same channel, sometimes multi-modalities would spring up later in the trajectory.\nProblem was that the softmax was stored as the prior for the next step, not the posterior.\nFixing it, resolves that and does in fact improve kp localization.\nThe numerical effect is not very large though.\nCould be that collapse of multi-modalities is not correct, but stable across a trajectory. In that case should still see improvement in policy learning.\nBut, I also observed some keypoints still moving. Could be that this only happens when the kp is moving outside too much.\nCould be that smaller sigma helps.\n","wordCount":"211","inLanguage":"en","datePublished":"2022-11-23T00:00:00Z","dateModified":"2022-11-23T00:00:00Z","author":{"@type":"Person","name":"Jan Ole von Hartz"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://vonhartz.info/pages/discrete-filter-debug/"},"publisher":{"@type":"Organization","name":"Jan Ole von Hartz","logo":{"@type":"ImageObject","url":"https://vonhartz.info/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://vonhartz.info accesskey=h title="Jan Ole von Hartz (Alt + H)">Jan Ole von Hartz</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://vonhartz.info/pages/cv/ title=CV><span>CV</span></a></li><li><a href=https://vonhartz.info/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://vonhartz.info/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://vonhartz.info/search/ title=Search><span>Search</span></a></li><li><a href=https://vonhartz.info/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Discrete Filter Debug</h1><div class=post-meta><span title='2022-11-23 00:00:00 +0000 UTC'>November 23, 2022</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;Jan Ole von Hartz</div></header><div class=post-content><p>This is a test/examle post.</p><p>How to</p><pre tabindex=0><code>&gt;&gt;&gt; import torch
&gt;&gt;&gt; import matplotlib.pyplot as plt

&gt;&gt;&gt; def plot(pr, sm, po, channel):
...     for i, d in enumerate([pr[channel], sm[channel], po[channel], (sm*pr)[channel]]):
...             plt.subplot(1, 4, i+1)
...             plt.imshow(d)
...     plt.show()

&gt;&gt;&gt; pr = torch.load(&#39;/export/hartzj/TakeLidOffSaucepan/demos_gt/encodings/dcm_10_keypoints_encoder-resnet101bs128split9010/new_ego/2022_05_03-14_34_44/cam_w_prior/80.dat&#39;)
&gt;&gt;&gt; po = torch.load(&#39;/export/hartzj/TakeLidOffSaucepan/demos_gt/encodings/dcm_10_keypoints_encoder-resnet101bs128split9010/new_ego/2022_05_03-14_34_44/cam_w_post/80.dat&#39;)
&gt;&gt;&gt; sm = torch.load(&#39;/export/hartzj/TakeLidOffSaucepan/demos_gt/encodings/dcm_10_keypoints_encoder-resnet101bs128split9010/new_ego/2022_05_03-14_34_44/cam_w_sm/80.dat&#39;)
</code></pre><p>Results for sigma=2</p><ul><li><p>Channels: 10, 2, 14</p></li><li><p>While on 2 it resolves the multimodality, on channel 10 it does not manage to do it. On Channel 14 it further manages to sharpen the cluster, but sometimes it also fails to do that.</p></li><li><p><del>I think the noise component in the motion model is too strong.</del></p></li></ul><p><img loading=lazy src=/assets/df-no-gain_1659603466739_0.png alt=df-no-gain.png></p><p><img loading=lazy src=/assets/df-not-quite-strong-enough_1659603495255_0.png alt=df-not-quite-strong-enough.png></p><p><img loading=lazy src=/assets/df-fixes-clutster_1659603501793_0.png alt=df-fixes-clutster.png></p><ul><li><p>If you look at successive frames of the same channel, sometimes multi-modalities would spring up later in the trajectory.</p></li><li><p>Problem was that the softmax was stored as the prior for the next step, not the posterior.</p></li><li><p>Fixing it, resolves that and does in fact improve kp localization.</p></li><li><p>The numerical effect is not very large though.</p><ul><li><p>Could be that collapse of multi-modalities is not correct, but stable across a trajectory. In that case should still see improvement in policy learning.</p></li><li><p>But, I also observed some keypoints still moving. Could be that this only happens when the kp is moving outside too much.</p></li><li><p>Could be that smaller sigma helps.</p></li></ul></li></ul></div><hr><aside><h4>No linked references</h4></aside><br><aside class=related></aside><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://vonhartz.info>Jan Ole von Hartz</a></span><br><span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a>
& <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
& <a href=https://github.com/sawhney17/logseq-schrodinger rel=noopener target=_blank>Logseq Schrödinger</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>